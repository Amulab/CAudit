import argparse
from copy import copy

from plugins.HWCloud import PluginHuaWeiCloudBase, HuaweiCloudApi
from utils import output
from utils.consts import AllPluginTypes


class PluginHuaweiCloudCreateBucket(PluginHuaWeiCloudBase):
    display = "创建bucket"
    alias = "h_create_bucket"
    p_type = AllPluginTypes.Exploit

    def __init__(self):
        super().__init__()

    def reg_argument(self, parser: argparse.ArgumentParser):
        parser.description = self.display
        parser.add_argument("-a", "--secret-id", required=True, help="secret id", dest="access_key")
        parser.add_argument("-s", "--secret-key", required=True, help="secret key", dest="secret_key")
        parser.add_argument("-n", "--bucket-name", required=True, help="bucket name", dest="bucket_name")
        parser.add_argument("-l", "--location", required=False, help="bucket location", dest="location")

    def run_script(self, args) -> dict:
        """
        脚本入口函数
        :return: bool
        """
        result = copy(self.result)

        hapi = HuaweiCloudApi(args.access_key, args.secret_key)
        hapi.create_bucket(args.bucket_name, args.location)

        return result
