import argparse
from copy import copy

from plugins.Exchange import PluginExchangeBase
from utils.consts import AllPluginTypes
from modules.exchangetool import ExchangeTool


class PluginExchangeEmailAddressSearch(PluginExchangeBase):
    display = "邮件地址搜索"
    alias = "ex_em_add"
    p_type = AllPluginTypes.Exploit

    def __init__(self):
        super().__init__()

    def reg_argument(self, parser: argparse.ArgumentParser):
        parser.description = self.display

        parser.add_argument("-d", "--domain", help="domain name.Format(domain.com)", required=True, dest="domain")
        parser.add_argument("-u", "--username", help="username to login", required=False, dest="username")
        parser.add_argument("-p", "--password", help="password", required=False, dest="password")
        parser.add_argument("-i", "--ip", help="target address", required=False, dest="ip")

    def run_script(self, args) -> dict:
        """
        脚本入口函数
        :return: bool
        """
        result = copy(self.result)

        ex = ExchangeTool(args.domain, args.username, args.password, args.ip)
        ex.get_all_email_address()

        return result
