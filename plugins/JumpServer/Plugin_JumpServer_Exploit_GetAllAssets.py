import argparse
from copy import copy

from plugins.Exchange import PluginExchangeBase
from plugins.JumpServer import JumpServerApi
from utils import output
from utils.consts import AllPluginTypes


class PluginJumpServerGetAllAssets(PluginExchangeBase):
    display = "获取所有资产"
    alias = "jpsv_getas"
    p_type = AllPluginTypes.Exploit

    def __init__(self):
        super().__init__()

    def reg_argument(self, parser: argparse.ArgumentParser):
        parser.description = self.display

        parser.add_argument("-i","--url", help="target url(https://xxx.com)", required=True, dest="url")
        parser.add_argument("--json", help="print json result", required=False, default=False, action=argparse.BooleanOptionalAction, dest="json")

        agroup = parser.add_argument_group("basic authenticate")
        agroup.add_argument("-u", "--username", help="username", dest="username")
        agroup.add_argument("-p", "--password", help="password", dest="password")

        tgroup = parser.add_argument_group("token authenticate")
        tgroup.add_argument("-t", "--token", help="use token login", dest="token")

    def run_script(self, args) -> dict:
        """
        脚本入口函数
        :return: bool
        """
        result = copy(self.result)

        url = args.url
        username = args.username
        password = args.password
        token = args.token
        is_json_output = args.json

        js = JumpServerApi(url, username, password, token)
        js.getAllAssetsInfo(is_json_output)

        return result
